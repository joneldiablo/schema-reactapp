{"version":3,"sources":["../src/js/controller.jsx"],"names":["Controller","mapRoutes","props","schema","routes","allRoutes","getRoutes","item","Array","isArray","map","a","resolveRefs","toReturn","Object","keys","forEach","k","assign","substring","split","pop","data","reduce","obj","key","type","from","pageId","page","content","ThisPage","Page","ThisSection","Section","i","components","templateId","children","template","ThisTemplate","Template","parent","schemaItem","getThisPaths","thisRoutes","r","path","p","exact","transition","absPath","flat","childrenRoutes","pages","templates","state","React","Component","RouterController","RController","BrowserRouterController","HashRouterController"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport {\n  HashRouter,\n  BrowserRouter,\n  withRouter,\n  Route,\n} from \"react-router-dom\";\nimport { AnimatedSwitch } from 'react-router-transition';\nimport urlJoin from \"url-join\";\nimport findComponent from \"./find-component\";\nimport mapRoutes from \"./map-routes\";\nimport Template from \"./containers/template\";\nimport Page from \"./containers/page\";\nimport Section from \"./containers/section\";\nimport getTransition from \"./transitions\";\n\nexport default class Controller extends React.Component {\n\n  static defaultProps = {\n    schema: { routes: [] },\n    Template,\n    Page,\n    Section\n  }\n\n  state = {\n    mapRoutes: mapRoutes(this.props.schema.routes),\n    allRoutes: this.getRoutes(this.props.schema.routes)\n    /*\nmodificar para usar la funcion de remplazo de referencias en todos lados, hacer que los objetos mezclen, usar elemento \"ref\" si es necesario....\nsections: this.resolveRefs(this.props.schema.sections),\ntemplates: this.resolveRefs(this.props.schema.templates),\nroutes: this.resolveRefs(this.props.schema.routes),\nmenus: this.resolveRefs(this.props.schema.menus),\npages: this.resolveRefs(this.props.schema.pages), */\n  }\n\n  resolveRefs(item) {\n    if (Array.isArray(item)) {\n      return item.map(a => this.resolveRefs(a));\n    } else if (typeof item === 'object') {\n      let toReturn = {};\n      Object.keys(item)\n        .forEach(k => {\n          if (k === 'ref') {\n            Object.assign(toReturn, this.resolveRefs(item[k]));\n            toReturn['id'] = item[k].substring(1).split('.').pop();\n          } else if (k === 'attributes') {\n            toReturn[k] = Object.assign(toReturn[k] || {}, this.resolveRefs(item[k]));\n          }\n          else toReturn[k] = this.resolveRefs(item[k])\n        });\n      return toReturn;\n    } else if (typeof item === 'string' && item[0] === '$') {\n      let { schema } = this.props;\n      let keys = item.substring(1).split('.');\n      let data = keys.reduce((obj, key) => obj[key], schema);\n      return this.resolveRefs(data);\n    } else return item;\n  }\n\n  components({ type, from } = {}) {\n    //type name of componente which colud find with \"findComponent\", from is the path to component, is not working, some love here!!!\n    return findComponent(type || from);\n  }\n\n  pages(pageId) {\n    let page = this.resolveRefs(pageId) || [];\n    let { content } = page;\n    if (Array.isArray(page)) content = page;\n    let ThisPage = this.props.Page;\n    let ThisSection = this.props.Section;\n    return <ThisPage {...page}>\n      {content.map((item, i) => <ThisSection key={i} {...item} Component={this.components(item)} />)}\n    </ThisPage>\n  }\n\n  templates(templateId, children) {\n    let template = this.resolveRefs(templateId) || [];\n    let { content } = template;\n    if (Array.isArray(template)) content = template;\n    let ThisTemplate = this.props.Template;\n    let ThisSection = this.props.Section;\n    return <ThisTemplate {...template}>\n      {content.map((item, i) => {\n        return <ThisSection key={i} {...item} Component={this.components(item)} children={children} />\n      })}\n    </ThisTemplate>\n  }\n\n  getRoutes(schema, parent = '/', key) {\n    let type = Array.isArray(schema) ? 'array' : typeof schema;\n    switch (type) {\n      case 'array': {\n        return schema.map((schemaItem, i) => this.getRoutes(schemaItem, parent, i));\n      }\n      case 'object': {\n        const getThisPaths = (thisRoutes) => {\n          return thisRoutes.map(r => {\n            if (!r.path)\n              return getThisPaths(r.children);\n            if (Array.isArray(r.path)) {\n              return r.path.map(p => urlJoin(parent, p));\n            }\n            return urlJoin(parent, r.path || '')\n          });\n        }\n        let { template, content, children, path, exact, transition } = schema;\n        let absPath = Array.isArray(path) ?\n          path.map(p => urlJoin(parent, p))\n          : urlJoin(parent, path || '/');\n        let props = {\n          path: path ? absPath : getThisPaths(children).flat(),\n          key,\n          exact\n        }\n        let childrenRoutes = <>\n          {content && this.pages(content)}\n          {children && <AnimatedSwitch {...getTransition(transition)}>\n            {this.getRoutes(children, absPath)}\n          </AnimatedSwitch>}\n        </>;\n        return <Route {...props} >\n          {template ?\n            this.templates(template, childrenRoutes) :\n            childrenRoutes\n          }\n        </Route>\n      }\n      default:\n        throw 'Invalid type: ' + type;\n    }\n  }\n\n  render() {\n    return this.state.allRoutes;\n  }\n}\n\nexport const RouterController = (props) => {\n  let RController = withRouter(Controller);\n  return (<RController {...props} />);\n}\n\nexport const BrowserRouterController = (props) => {\n  let RController = withRouter(Controller);\n  return (<BrowserRouter><RController {...props} /></BrowserRouter>);\n}\n\nexport const HashRouterController = (props) => {\n  let RController = withRouter(Controller);\n  return (<HashRouter><RController {...props} /></HashRouter>);\n}"],"file":"controller.js"}